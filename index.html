<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVA Challenge</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles */
        body {
            font-family: 'Lato', sans-serif;
            background-color: #FDF8F2; /* Creamy background */
            color: #4B3F3F; /* Dark brown text */
        }
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }
        
        /* Sonoma Theme (Green) */
        .theme-text { color: #14532D; }
        .theme-bg { background-color: #166534; }
        .theme-bg-hover:hover { background-color: #14532D; }
        .theme-bg-light { background-color: #F0FDF4; }
        .theme-border-light { border-color: #BBF7D0; }
        
        /* Napa Theme (Violet) */
        .napa-text { color: #4C1D95; }
        .napa-bg { background-color: #5B21B6; }
        .napa-bg-hover:hover { background-color: #4C1D95; }
        
        /* Central Coast Theme (Blue) */
        .central-text { color: #1E40AF; }
        .central-bg { background-color: #1E40AF; }
        .central-bg-hover:hover { background-color: #1E3A8A; }

        /* Oregon Theme (Emerald) */
        .oregon-text { color: #047857; }
        .oregon-bg { background-color: #047857; }
        .oregon-bg-hover:hover { background-color: #065F46; }

        /* Washington Theme (Sky) */
        .washington-text { color: #0369A1; }
        .washington-bg { background-color: #0369A1; }
        .washington-bg-hover:hover { background-color: #075985; }

        /* Sierra/Mendo/Lake Theme (Amber) */
        .sierra-text { color: #92400E; }
        .sierra-bg { background-color: #92400E; }
        .sierra-bg-hover:hover { background-color: #78350F; }

        /* Game styles */
        .game-card {
            background-color: #FFFFFF;
            border: 1px solid #DED1C1;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn-choice {
            transition: all 0.2s ease-in-out;
            border: 2px solid #DED1C1;
            background-color: #fff;
        }
        .btn-choice:not(:disabled):hover {
            background-color: #FDF8F2;
            transform: translateY(-2px);
        }
        .btn-choice.selected {
            background-color: #E0E7FF; /* Light blue for selected */
            border-color: #A5B4FC;
        }
        .btn-choice.correct {
            background-color: #D1FAE5; /* Green for correct */
            border-color: #6EE7B7;
            color: #065F46;
            cursor: not-allowed;
        }
        .btn-choice.incorrect {
            animation: shake 0.5s;
            background-color: #FEE2E2; /* Red for incorrect */
            border-color: #FCA5A5;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Start Game Modal -->
    <div id="start-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full text-center transform transition-all">
            <h2 class="text-4xl font-bold mb-4 theme-text">AVA Challenge</h2>
            <p class="text-lg mb-6 text-left text-gray-700">Test your knowledge by matching Producers and Vineyards to their correct AVAs.</p>
            <div class="text-left space-y-3 mb-8 theme-bg-light p-4 rounded-lg border theme-border-light">
                <p><strong class="theme-text">GOAL:</strong> Match the items in the left column to the correct AVA in the right column.</p>
                <p><strong class="theme-text">SCORING:</strong></p>
                <ul class="list-disc list-inside pl-4 text-gray-600">
                    <li><span class="font-bold text-green-700">+2 points</span> for a correct match on the first try.</li>
                    <li><span class="font-bold text-green-700">+1 point</span> for a correct match on subsequent tries.</li>
                    <li><span class="font-bold text-red-700">-1 point</span> for an incorrect match.</li>
                </ul>
            </div>
            <!-- Game Mode Selection -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                 <button id="start-sonoma-btn" class="w-full theme-bg text-white font-bold py-3 px-4 rounded-lg theme-bg-hover transition-colors text-lg">
                    Sonoma
                </button>
                <button id="start-napa-btn" class="w-full napa-bg text-white font-bold py-3 px-4 rounded-lg napa-bg-hover transition-colors text-lg">
                    Napa
                </button>
                <button id="start-central-btn" class="w-full central-bg text-white font-bold py-3 px-4 rounded-lg central-bg-hover transition-colors text-lg">
                    Central Coast
                </button>
                <button id="start-oregon-btn" class="w-full oregon-bg text-white font-bold py-3 px-4 rounded-lg oregon-bg-hover transition-colors text-lg">
                    Oregon
                </button>
                <button id="start-washington-btn" class="w-full washington-bg text-white font-bold py-3 px-4 rounded-lg washington-bg-hover transition-colors text-lg">
                    Washington
                </button>
                 <button id="start-sierra-btn" class="w-full sierra-bg text-white font-bold py-3 px-4 rounded-lg sierra-bg-hover transition-colors text-lg">
                    Sierra/Mendo/Lake
                </button>
            </div>
        </div>
    </div>

    <!-- Main Game Container -->
    <div id="game-container" class="w-full max-w-5xl mx-auto hidden">
        <!-- Main Menu Button -->
        <div class="mb-4">
            <button id="main-menu-btn" class="text-sm text-gray-500 hover:text-gray-800 transition-colors">&larr; Main Menu</button>
        </div>
        
        <div class="text-center mb-6">
            <h1 id="game-title" class="text-4xl md:text-5xl font-bold theme-text">Sonoma AVA Master</h1>
            <p class="text-lg text-gray-600 mt-2">Producer & Vineyard Challenge</p>
        </div>

        <!-- Score and Round Info -->
        <div class="flex justify-between items-center mb-6 p-4 rounded-lg theme-bg-light text-green-900 game-card">
            <div class="text-center w-1/2">
                <h3 class="text-xl font-bold">Round</h3>
                <p id="round-info" class="text-2xl font-semibold">1 / 20</p>
            </div>
            <div class="border-l border-gray-300 h-12"></div>
            <div class="text-center w-1/2">
                <h3 class="text-xl font-bold">Score</h3>
                <p id="score-info" class="text-2xl font-semibold">0</p>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="game-card rounded-lg p-6 md:p-8">
            <!-- Updated grid for mobile -->
            <div class="grid grid-cols-2 gap-4 md:gap-10">
                <!-- Left Column -->
                <div>
                    <h3 id="column-title" class="text-2xl font-bold text-center mb-4 theme-text">Producers</h3>
                    <div id="left-column" class="flex flex-col space-y-3">
                        <!-- Left buttons will be inserted here -->
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <h3 id="column-ava-title" class="text-2xl font-bold text-center mb-4 theme-text">AVAs</h3>
                    <div id="right-column" class="flex flex-col space-y-3">
                        <!-- Right buttons will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center transform transition-all scale-95 opacity-0">
            <h2 class="text-4xl font-bold mb-4 text-green-700">Round Complete!</h2>
            <button id="next-round-btn" class="w-full theme-bg text-white font-bold py-3 px-4 rounded-lg theme-bg-hover transition-colors text-lg">Next Round</button>
        </div>
    </div>
    
    <!-- Game Over Modal -->
    <div id="game-over-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center transform transition-all scale-95 opacity-0">
            <h2 id="game-over-title" class="text-4xl font-bold mb-4 theme-text">Game Over!</h2>
            <p id="final-score-message" class="text-3xl font-bold mb-4 theme-text"></p>
            <div class="theme-bg-light p-4 rounded-lg mb-6">
                <p class="text-lg text-left clear-both">Final Score: <span id="final-score" class="font-bold float-right">0</span></p>
                <p class="text-lg text-left mt-1 clear-both">Percentage: <span id="final-percentage" class="font-bold float-right">0%</span></p>
            </div>
            <button id="play-again-btn" class="w-full theme-bg text-white font-bold py-3 px-4 rounded-lg theme-bg-hover transition-colors text-lg">Play Again</button>
        </div>
    </div>

    <script>
        // --- SONOMA DATABASE ---
        const sonomaProducersData = [
            { name: "Alexander Valley Vineyards", ava: "Alexander Valley AVA" },
            { name: "Jordan", ava: "Alexander Valley AVA" },
            { name: "Silver Oak", ava: "Alexander Valley AVA" },
            { name: "Stonestreet", ava: "Alexander Valley AVA" },
            { name: "Rodney Strong", ava: "Alexander Valley AVA" },
            { name: "Matanzas Creek", ava: "Bennett Valley AVA" },
            { name: "Bevan", ava: "Bennett Valley AVA" },
            { name: "Chalk Hill Estate", ava: "Chalk Hill AVA" },
            { name: "A. Raffanelli", ava: "Dry Creek Valley AVA" },
            { name: "Armida", ava: "Dry Creek Valley AVA" },
            { name: "Michel-Schlumberger", ava: "Dry Creek Valley AVA" },
            { name: "Failla", ava: "Fort Ross - Seaview AVA" },
            { name: "Flowers", ava: "Fort Ross - Seaview AVA" },
            { name: "Red Car", ava: "Fort Ross - Seaview AVA" },
            { name: "Aldina", ava: "Fountaingrove District AVA" },
            { name: "Petrichor Estate", ava: "Fountaingrove District AVA" },
            { name: "Dutton Estate", ava: "Green Valley of the Russian River Valley AVA" },
            { name: "Dutton-Goldfield", ava: "Green Valley of the Russian River Valley AVA" },
            { name: "Iron Horse Vineyards", ava: "Green Valley of the Russian River Valley AVA" },
            { name: "Anakota", ava: "Knights Valley AVA" },
            { name: "Beringer", ava: "Knights Valley AVA" },
            { name: "Peter Michael", ava: "Knights Valley AVA" },
            { name: "Bouchaine", ava: "Los Carneros AVA" },
            { name: "Domaine Carneros", ava: "Los Carneros AVA" },
            { name: "Etude", ava: "Los Carneros AVA" },
            { name: "Poseidon", ava: "Los Carneros AVA" },
            { name: "Truchard", ava: "Los Carneros AVA" },
            { name: "Amapola Creek", ava: "Moon Mountain District Sonoma County AVA" },
            { name: "Keller Estate", ava: "Petaluma Gap AVA" },
            { name: "Captûre Wines", ava: "Pine Mountain–Cloverdale Peak AVA" },
            { name: "Imagery Estate Winery", ava: "Pine Mountain–Cloverdale Peak AVA" },
            { name: "Mauritson Winery", ava: "Rockpile AVA" },
            { name: "Joseph Swan", ava: "Russian River Valley AVA" },
            { name: "Rochioli", ava: "Russian River Valley AVA" },
            { name: "Williams-Seylem", ava: "Russian River Valley AVA" },
            { name: "Kistler", ava: "Russian River Valley AVA" },
            { name: "Sonoma-Cutrer", ava: "Sonoma Coast AVA" },
            { name: "Benziger", ava: "Sonoma Mountain AVA" },
            { name: "Laurel Glen", ava: "Sonoma Mountain AVA" },
            { name: "Buena Vista Winery", ava: "Sonoma Valley AVA" },
            { name: "Hanzell", ava: "Sonoma Valley AVA" },
            { name: "Littorai", ava: "West Sonoma Coast AVA" },
            { name: "Peay Vineyards", ava: "West Sonoma Coast AVA" },
            { name: "Hirsch Vineyards", ava: "West Sonoma Coast AVA" },
            { name: "DuMOL", ava: "West Sonoma Coast AVA" }
        ];

        const sonomaVineyardsData = [
            { name: "Geyserville", ava: "Alexander Valley AVA" },
            { name: "Robert Young Estate", ava: "Alexander Valley AVA" },
            { name: "Dry Stack Vineyard", ava: "Bennett Valley AVA" },
            { name: "Simpatico Ranch Vineyard", ava: "Bennett Valley AVA" },
            { name: "Clajeaux Vineyard", ava: "Chalk Hill AVA" },
            { name: "Trinité Estate", ava: "Chalk Hill AVA" },
            { name: "Teldeschi Vineyard", ava: "Dry Creek Valley AVA" },
            { name: "Ridge Lytton Springs", ava: "Dry Creek Valley AVA" },
            { name: "Fort Ross Vineyard", ava: "Fort Ross - Seaview AVA" },
            { name: "Martinelli Vineyard", ava: "Fort Ross - Seaview AVA" },
            { name: "Fountain Grove Vineyard", ava: "Fountaingrove District AVA" },
            { name: "Kick Ranch Vineyard", ava: "Fountaingrove District AVA" },
            { name: "Keefer Ranch", ava: "Green Valley of the Russian River Valley AVA" },
            { name: "Morelli Lane Vineyard", ava: "Green Valley of the Russian River Valley AVA" },
            { name: "Charles Heintz", ava: "Green Valley of the Russian River Valley AVA" },
            { name: "Knights Bridge Vineyard", ava: "Knights Valley AVA" },
            { name: "Stanly Ranch", ava: "Los Carneros AVA" },
            { name: "Sangiacomo Vineyard", ava: "Los Carneros AVA" },
            { name: "Monte Rosso Vineyard", ava: "Moon Mountain District Sonoma County AVA" },
            { name: "Montecillo Vineyard", ava: "Moon Mountain District Sonoma County AVA" },
            { name: "Ambassador’s 1953 Vineyard", ava: "Moon Mountain District Sonoma County AVA" },
            { name: "Gap's Crown Vineyard", ava: "Petaluma Gap AVA" },
            { name: "Robert's Road Vineyard", ava: "Petaluma Gap AVA" },
            { name: "Sun Chase Vineyard", ava: "Petaluma Gap AVA" },
            { name: "Pine Mountain Vineyards", ava: "Pine Mountain–Cloverdale Peak AVA" },
            { name: "Upper Ridge Vineyard", ava: "Pine Mountain–Cloverdale Peak AVA" },
            { name: "Botticelli Vineyard", ava: "Rockpile AVA" },
            { name: "Rocky Ridge Vineyard", ava: "Rockpile AVA" },
            { name: "Rockpile Vineyard", ava: "Rockpile AVA" },
            { name: "Ritchie Vineyard", ava: "Russian River Valley AVA" },
            { name: "Jackass Hill Vineyard", ava: "Russian River Valley AVA" },
            { name: "Coastlands Vineyard", ava: "Sonoma Coast AVA" },
            { name: "Marcassin Vineyard", ava: "Sonoma Coast AVA" },
            { name: "Occidental Vineyard", ava: "West Sonoma Coast AVA" },
            { name: "Pickberry Vineyard", ava: "Sonoma Mountain AVA" },
            { name: "Van der Kamp Vineyard", ava: "Sonoma Mountain AVA" },
            { name: "Bedrock Vineyard", ava: "Sonoma Valley AVA" },
            { name: "Durell Vineyard", ava: "Sonoma Valley AVA" },
            { name: "Pagani Ranch", ava: "Sonoma Valley AVA" },
            { name: "Peay Estate Vineyard", ava: "West Sonoma Coast AVA" },
            { name: "B.A. Thieriot Vineyard", ava: "West Sonoma Coast AVA" }
        ];

        // --- NAPA DATABASE ---
        const napaProducersData = [
            { name: "Antica", ava: "Atlas Peak AVA" },
            { name: "Au Sommet", ava: "Atlas Peak AVA" },
            { name: "Kongsgaard", ava: "Atlas Peak AVA" },
            { name: "Araujo (Eisele Vineyard Estate)", ava: "Calistoga AVA" },
            { name: "Aubert", ava: "Calistoga AVA" },
            { name: "Bennett Lane", ava: "Calistoga AVA" },
            { name: "Chateau Montelena", ava: "Calistoga AVA" },
            { name: "Hundred Acre", ava: "Calistoga AVA" },
            { name: "Jericho Canyon", ava: "Calistoga AVA" },
            { name: "Larkmead", ava: "Calistoga AVA" },
            { name: "Schrader Cellars", ava: "Calistoga AVA" },
            { name: "Sterling", ava: "Calistoga AVA" },
            { name: "Storybook Mountain", ava: "Calistoga AVA" },
            { name: "Twomey", ava: "Calistoga AVA" },
            { name: "Brown", ava: "Chiles Valley AVA" },
            { name: "Green & Red", ava: "Chiles Valley AVA" },
            { name: "Nichelini", ava: "Chiles Valley AVA" },
            { name: "Volker Eisele", ava: "Chiles Valley AVA" },
            { name: "Arrow & Branch", ava: "Coombsville AVA" },
            { name: "Caldwell", ava: "Coombsville AVA" },
            { name: "Favia", ava: "Coombsville AVA" },
            { name: "Palmaz", ava: "Coombsville AVA" },
            { name: "Tournesol", ava: "Coombsville AVA" },
            { name: "Tulocay", ava: "Coombsville AVA" },
            { name: "Burgess Cellars", ava: "Crystal Springs of Napa Valley AVA" },
            { name: "Viader", ava: "Crystal Springs of Napa Valley AVA" },
            { name: "Constant", ava: "Diamond Mountain District AVA" },
            { name: "Diamond Creek", ava: "Diamond Mountain District AVA" },
            { name: "Dyer Straits", ava: "Diamond Mountain District AVA" },
            { name: "Schramsberg", ava: "Diamond Mountain District AVA" },
            { name: "Cade", ava: "Howell Mountain AVA" },
            { name: "Dunn", ava: "Howell Mountain AVA" },
            { name: "La Jota", ava: "Howell Mountain AVA" },
            { name: "O'Shaughnessy", ava: "Howell Mountain AVA" },
            { name: "Robert Craig", ava: "Howell Mountain AVA" },
            { name: "Bouchaine", ava: "Los Carneros AVA" },
            { name: "Domaine Carneros", ava: "Los Carneros AVA" },
            { name: "Etude", ava: "Los Carneros AVA" },
            { name: "Truchard", ava: "Los Carneros AVA" },
            { name: "Hess", ava: "Mount Veeder AVA" },
            { name: "Lagier-Meredith", ava: "Mount Veeder AVA" },
            { name: "Mayacamas", ava: "Mount Veeder AVA" },
            { name: "Progeny", ava: "Mount Veeder AVA" },
            { name: "Sky", ava: "Mount Veeder AVA" },
            { name: "Hendry Ranch", ava: "Oak Knoll District of Napa Valley AVA" },
            { name: "Laird", ava: "Oak Knoll District of Napa Valley AVA" },
            { name: "Matthiasson", ava: "Oak Knoll District of Napa Valley AVA" },
            { name: "Monticello", ava: "Oak Knoll District of Napa Valley AVA" },
            { name: "Robert Biale", ava: "Oak Knoll District of Napa Valley AVA" },
            { name: "Trefethen", ava: "Oak Knoll District of Napa Valley AVA" },
            { name: "Dalla Valle", ava: "Oakville AVA" },
            { name: "Far Niente", ava: "Oakville AVA" },
            { name: "Futo", ava: "Oakville AVA" },
            { name: "Groth", ava: "Oakville AVA" },
            { name: "Harlan", ava: "Oakville AVA" },
            { name: "MacDonald", ava: "Oakville AVA" },
            { name: "Opus One", ava: "Oakville AVA" },
            { name: "Robert Mondavi", ava: "Oakville AVA" },
            { name: "Rudd", ava: "Oakville AVA" },
            { name: "Screaming Eagle", ava: "Oakville AVA" },
            { name: "Silver Oak", ava: "Oakville AVA" },
            { name: "Beaulieu Vineyard", ava: "Rutherford AVA" },
            { name: "Cakebread", ava: "Rutherford AVA" },
            { name: "Caymus", ava: "Rutherford AVA" },
            { name: "Frog's Leap", ava: "Rutherford AVA" },
            { name: "Grgich Hills", ava: "Rutherford AVA" },
            { name: "Inglenook", ava: "Rutherford AVA" },
            { name: "Long Meadow Ranch", ava: "Rutherford AVA" },
            { name: "Quintessa", ava: "Rutherford AVA" },
            { name: "Raymond", ava: "Rutherford AVA" },
            { name: "Round Pond", ava: "Rutherford AVA" },
            { name: "Staglin", ava: "Rutherford AVA" },
            { name: "St. Supéry", ava: "Rutherford AVA" },
            { name: "Barnett", ava: "Spring Mountain District AVA" },
            { name: "Behrens", ava: "Spring Mountain District AVA" },
            { name: "Cain", ava: "Spring Mountain District AVA" },
            { name: "Newton", ava: "Spring Mountain District AVA" },
            { name: "Philip Togni", ava: "Spring Mountain District AVA" },
            { name: "Pride Mountain", ava: "Spring Mountain District AVA" },
            { name: "Ritchie Creek", ava: "Spring Mountain District AVA" },
            { name: "Smith-Madrone", ava: "Spring Mountain District AVA" },
            { name: "Spring Mountain", ava: "Spring Mountain District AVA" },
            { name: "Stony Hill", ava: "Spring Mountain District AVA" },
            { name: "Terra Valentine", ava: "Spring Mountain District AVA" },
            { name: "Beringer", ava: "St. Helena AVA" },
            { name: "Charles Krug", ava: "St. Helena AVA" },
            { name: "Corison", ava: "St. Helena AVA" },
            { name: "Crocker", ava: "St. Helena AVA" },
            { name: "Forman", ava: "St. Helena AVA" },
            { name: "Freemark Abbey", ava: "St. Helena AVA" },
            { name: "Grace Family", ava: "St. Helena AVA" },
            { name: "Heitz", ava: "St. Helena AVA" },
            { name: "Hourglass", ava: "St. Helena AVA" },
            { name: "Joseph Phelps", ava: "St. Helena AVA" },
            { name: "Louis M. Martini", ava: "St. Helena AVA" },
            { name: "Merryvale", ava: "St. Helena AVA" },
            { name: "Rombauer Vineyard", ava: "St. Helena AVA" },
            { name: "Spottswoode", ava: "St. Helena AVA" },
            { name: "St. Clement", ava: "St. Helena AVA" },
            { name: "Turley", ava: "St. Helena AVA" },
            { name: "Vineyard 29", ava: "St. Helena AVA" },
            { name: "Chimney Rock", ava: "Stags Leap District AVA" },
            { name: "Cliff Lede", ava: "Stags Leap District AVA" },
            { name: "Clos du Val", ava: "Stags Leap District AVA" },
            { name: "Futo 5500", ava: "Stags Leap District AVA" },
            { name: "Hartwell", ava: "Stags Leap District AVA" },
            { name: "Odette", ava: "Stags Leap District AVA" },
            { name: "Pine Ridge", ava: "Stags Leap District AVA" },
            { name: "Poetry", ava: "Stags Leap District AVA" },
            { name: "Realm", ava: "Stags Leap District AVA" },
            { name: "Robert Sinskey", ava: "Stags Leap District AVA" },
            { name: "Shafer", ava: "Stags Leap District AVA" },
            { name: "Silverado Vineyards", ava: "Stags Leap District AVA" },
            { name: "Stag's Leap Wine Cellars", ava: "Stags Leap District AVA" },
            { name: "Stags' Leap Winery", ava: "Stags Leap District AVA" },
            { name: "Steltzner", ava: "Stags Leap District AVA" },
            { name: "Olivia Brion", ava: "Wild Horse Valley AVA" },
            { name: "Blankiet", ava: "Yountville AVA" },
            { name: "Domaine Chandon", ava: "Yountville AVA" },
            { name: "Dominus", ava: "Yountville AVA" },
            { name: "Gemstone", ava: "Yountville AVA" },
            { name: "Kapcsándy", ava: "Yountville AVA" },
            { name: "Keever", ava: "Yountville AVA" }
        ];

        const napaVineyardsData = [
            { name: "Stagecoach", ava: "Atlas Peak AVA" },
            { name: "Water Ranch", ava: "Atlas Peak AVA" },
            { name: "Eisele", ava: "Calistoga AVA" },
            { name: "Frediani", ava: "Calistoga AVA" },
            { name: "Lamb", ava: "Calistoga AVA" },
            { name: "Luvisi", ava: "Calistoga AVA" },
            { name: "Three Palms", ava: "Calistoga AVA" },
            { name: "Tofanelli", ava: "Calistoga AVA" },
            { name: "Arcadia", ava: "Coombsville AVA" },
            { name: "Dead Fred", ava: "Coombsville AVA" },
            { name: "Haynes", ava: "Coombsville AVA" },
            { name: "Judge", ava: "Coombsville AVA" },
            { name: "Meteor", ava: "Coombsville AVA" },
            { name: "Moore", ava: "Coombsville AVA" },
            { name: "Gravelly Meadow", ava: "Diamond Mountain District AVA" },
            { name: "Jasud", ava: "Diamond Mountain District AVA" },
            { name: "Lake", ava: "Diamond Mountain District AVA" },
            { name: "Red Rock Terrace", ava: "Diamond Mountain District AVA" },
            { name: "Volcanic Hill", ava: "Diamond Mountain District AVA" },
            { name: "Bancroft Ranch", ava: "Howell Mountain AVA" },
            { name: "Beatty Ranch", ava: "Howell Mountain AVA" },
            { name: "Black Sears", ava: "Howell Mountain AVA" },
            { name: "Dragon", ava: "Howell Mountain AVA" },
            { name: "Las Posadas", ava: "Howell Mountain AVA" },
            { name: "Rattlesnake Ridge", ava: "Howell Mountain AVA" },
            { name: "Steinhauer", ava: "Howell Mountain AVA" },
            { name: "True", ava: "Howell Mountain AVA" },
            { name: "W. S. Keyes", ava: "Howell Mountain AVA" },
            { name: "Hudson", ava: "Los Carneros AVA" },
            { name: "Hyde", ava: "Los Carneros AVA" },
            { name: "Poseidon", ava: "Los Carneros AVA" },
            { name: "Stanly Ranch", ava: "Los Carneros AVA" },
            { name: "Abel 1833", ava: "Mount Veeder AVA" },
            { name: "Mt. Veeder", ava: "Mount Veeder AVA" },
            { name: "Scaggs", ava: "Mount Veeder AVA" },
            { name: "Blackbird", ava: "Oak Knoll District of Napa Valley AVA" },
            { name: "Backus", ava: "Oakville AVA" },
            { name: "Beckstoffer Missouri Hopper", ava: "Oakville AVA" },
            { name: "Beckstoffer To-Kalon", ava: "Oakville AVA" },
            { name: "Detert", ava: "Oakville AVA" },
            { name: "Gamble Ranch", ava: "Oakville AVA" },
            { name: "Martha’s Vineyard", ava: "Oakville AVA" },
            { name: "Martin Stelling", ava: "Oakville AVA" },
            { name: "Oakville Ranch", ava: "Oakville AVA" },
            { name: "St. Eden", ava: "Oakville AVA" },
            { name: "Tench", ava: "Oakville AVA" },
            { name: "Vine Hill", ava: "Oakville AVA" },
            { name: "Weitz", ava: "Oakville AVA" },
            { name: "Beckstoffer Georges III", ava: "Rutherford AVA" },
            { name: "Beckstoffer Melrose", ava: "Rutherford AVA" },
            { name: "Booth Bella Oaks", ava: "Rutherford AVA" },
            { name: "Bosché", ava: "Rutherford AVA" },
            { name: "Star", ava: "Rutherford AVA" },
            { name: "Sycamore", ava: "Rutherford AVA" },
            { name: "Marston", ava: "Spring Mountain District AVA" },
            { name: "School House", ava: "Spring Mountain District AVA" },
            { name: "Aida", ava: "St. Helena AVA" },
            { name: "Beckstoffer Bourn", ava: "St. Helena AVA" },
            { name: "Beckstoffer Crane", ava: "St. Helena AVA" },
            { name: "Beckstoffer Las Piedras", ava: "St. Helena AVA" },
            { name: "Capella", ava: "St. Helena AVA" },
            { name: "Edge Hill", ava: "St. Helena AVA" },
            { name: "Hayne", ava: "St. Helena AVA" },
            { name: "Kayli Morgan", ava: "St. Helena AVA" },
            { name: "Kronos", ava: "St. Helena AVA" },
            { name: "Lewelling", ava: "St. Helena AVA" },
            { name: "Library", ava: "St. Helena AVA" },
            { name: "Madrona", ava: "St. Helena AVA" },
            { name: "Quella", ava: "St. Helena AVA" },
            { name: "Tychson Hill", ava: "St. Helena AVA" },
            { name: "Fay", ava: "Stags Leap District AVA" },
            { name: "Regusci", ava: "Stags Leap District AVA" },
            { name: "Wappo Hill", ava: "Stags Leap District AVA" },
            { name: "Heron Lake", ava: "Wild Horse Valley AVA" },
            { name: "Ghost Block", ava: "Yountville AVA" },
            { name: "Grgich", ava: "Yountville AVA" },
            { name: "Napanook", ava: "Yountville AVA" },
            { name: "Reese/Sleeping Lady", ava: "Yountville AVA" }
        ];

        // --- CENTRAL COAST DATABASE ---
        const centralProducersData = [
            { name: "Wente Vineyards", ava: "Livermore Valley AVA" },
            { name: "Concannon Vineyard", ava: "Livermore Valley AVA" },
            { name: "Bernardus", ava: "Carmel Valley AVA" },
            { name: "Galante Vineyards", ava: "Carmel Valley AVA" },
            { name: "Massa Vineyard", ava: "Carmel Valley AVA" },
            { name: "Chalone", ava: "Chalone AVA" },
            { name: "Blair Estate", ava: "Arroyo Seco AVA" },
            { name: "Joyce Vineyards", ava: "Arroyo Seco AVA" },
            { name: "J. Lohr", ava: "Arroyo Seco AVA" },
            { name: "Wente", ava: "Arroyo Seco AVA" },
            { name: "Delicato Family Vineyards", ava: "San Bernabe AVA" },
            { name: "Siduri", ava: "Santa Lucia Highlands AVA" },
            { name: "Roar", ava: "Santa Lucia Highlands AVA" },
            { name: "Morgan", ava: "Santa Lucia Highlands AVA" },
            { name: "Kosta Browne", ava: "Santa Lucia Highlands AVA" },
            { name: "Paul Lato", ava: "Santa Lucia Highlands AVA" },
            { name: "Lepe Cellars", ava: "San Antonio Valley AVA" },
            { name: "Line Shack", ava: "San Antonio Valley AVA" },
            { name: "Eden Rift", ava: "Cienega Valley AVA" },
            { name: "I.Brand & Family", ava: "Cienega Valley AVA" },
            { name: "Calera", ava: "Gabilan Mountains AVA" },
            { name: "Chalone", ava: "Gabilan Mountains AVA" },
            { name: "Calera", ava: "Mt. Harlan AVA" },
            { name: "Donati Family", ava: "Paicines AVA" },
            { name: "Puma Road", ava: "Paicines AVA" },
            { name: "Tablas Creek", ava: "Paso Robles AVA" },
            { name: "Justin", ava: "Paso Robles AVA" },
            { name: "Saxum", ava: "Paso Robles AVA" },
            { name: "Austin Hope", ava: "Paso Robles AVA" },
            { name: "J. Lohr", ava: "Paso Robles AVA" },
            { name: "Adelaida Cellars", ava: "Adelaida District AVA" },
            { name: "Tablas Creek", ava: "Adelaida District AVA" },
            { name: "Daou", ava: "Adelaida District AVA" },
            { name: "Absolution Cellars", ava: "Creston District AVA" },
            { name: "Chateau Margene", ava: "Creston District AVA" },
            { name: "Bovino Vineyards", ava: "El Pomar District AVA" },
            { name: "J. Lohr", ava: "El Pomar District AVA" },
            { name: "Stilson Cellars", ava: "El Pomar District AVA" },
            { name: "Eberle Winery", ava: "Paso Robles Estrella District AVA" },
            { name: "J. Lohr", ava: "Paso Robles Estrella District AVA" },
            { name: "Broken Earth", ava: "Paso Robles Estrella District AVA" },
            { name: "Meridien Cellars", ava: "Paso Robles Estrella District AVA" },
            { name: "Cass", ava: "Paso Robles Geneseo District AVA" },
            { name: "Thatcher Winery", ava: "Paso Robles Highlands AVA" },
            { name: "Reciprocity", ava: "Paso Robles Highlands AVA" },
            { name: "Saxum", ava: "Paso Robles Willow Creek District AVA" },
            { name: "Linnie Calodo", ava: "Paso Robles Willow Creek District AVA" },
            { name: "Terry Hoage", ava: "Paso Robles Willow Creek District AVA" },
            { name: "Sycamore Ranch", ava: "San Miguel District AVA" },
            { name: "Austin Hope", ava: "Templeton Gap AVA" },
            { name: "Four Lanterns", ava: "Templeton Gap AVA" },
            { name: "Dunites", ava: "SLO Coast AVA" },
            { name: "Phelan Farm", ava: "SLO Coast AVA" },
            { name: "Talley Vineyards", ava: "Arroyo Grande Valley AVA" },
            { name: "Laetitia Vineyard", ava: "Arroyo Grande Valley AVA" },
            { name: "Alban Vineyards", ava: "Edna Valley AVA" },
            { name: "Tolosa Winery", ava: "Edna Valley AVA" },
            { name: "Lindquist Vineyard", ava: "Edna Valley AVA" },
            { name: "Epoch Wines", ava: "York Mountain AVA" }
        ];

        const centralVineyardsData = [
            { name: "Hames Valley Vineyard", ava: "Hames Valley AVA" },
            { name:Ill: "Pisoni Vineyard", ava: "Santa Lucia Highlands AVA" },
            { name: "Gary's Vineyard", ava: "Santa Lucia Highlands AVA" },
            { name: "Enz Vineyard", ava: "Lime Kiln Valley AVA" }
        ];

        // --- OREGON DATABASE ---
        const allOregonData = [
            { name: "Cowhorn", ava: "Applegate Valley AVA" },
            { name: "Troon Vineyard", ava: "Applegate Valley AVA" },
            { name: "Adelsheim", ava: "Chehalem Mountains AVA" },
            { name: "Ponzi", ava: "Chehalem Mountains AVA" },
            { name: "Analemma", ava: "Columbia Gorge AVA (Oregon)" },
            { name: "Hiyu Wine Darm", ava: "Columbia Gorge AVA (Oregon)" },
            { name: "Atavus Vineyard", ava: "Columbia Gorge AVA (Oregon)" },
            { name: "Celio Vineyard", ava: "Columbia Gorge AVA (Oregon)" },
            { name: "Eyrie", ava: "Dundee Hills AVA" },
            { name: "Cameron", ava: "Dundee Hills AVA" },
            { name: "Domaine Drouhin", ava: "Dundee Hills AVA" },
            { name: "Bergström", ava: "Dundee Hills AVA" },
            { name: "Domaine Serene", ava: "Dundee Hills AVA" },
            { name: "Lingua Franca", ava: "Eola Amity Hills AVA" },
            { name: "Walter Scott", ava: "Eola Amity Hills AVA" },
            { name: "Bethel Heights", ava: "Eola Amity Hills AVA" },
            { name: "Seven Springs Vineyard", ava: "Eola Amity Hills AVA" },
            { name: "Jerusalem Hill Vineyard", ava: "Eola Amity Hills AVA" },
            { name: "Carter Vineyard", ava: "Eola Amity Hills AVA" },
            { name: "Brandborg", ava: "Elkton Oregon AVA" },
            { name: "River's Edge", ava: "Elkton Oregon AVA" },
            { name: "Ponzi Vineyards", ava: "Laurelwood District AVA" },
            { name: "Dion Vineyards", ava: "Laurelwood District AVA" },
            { name: "Antiquum Farm", ava: "Lower Long Tom AVA" },
            { name: "Walnut Ridge Vineyard", ava: "Lower Long Tom AVA" },
            { name: "Maysara", ava: "McMinnville AVA" },
            { name: "Brittan", ava: "McMinnville AVA" },
            { name: "Brittan Vineyards", ava: "McMinnville AVA" },
            { name: "Illahe Vineyards", ava: "Mount Pisgah-Polk County, Oregon AVA" },
            { name: "Open Claim Vineyards", ava: "Mount Pisgah-Polk County, Oregon AVA" },
            { name: "Red Hill Vineyard", ava: "Red Hill Douglas County, Oregon AVA" },
            { name: "Beaux Frères", ava: "Ribbon Ridge AVA" },
            { name: "Brick House", ava: "Ribbon Ridge AVA" },
            { name: "2Hawk Winery", ava: "Rogue Valley AVA" },
            { name: "Foris", ava: "Rogue Valley AVA" },
            { name: "Quady North", ava: "Rogue Valley AVA" },
            { name: "Sawtooth Winery", ava: "Snake River Valley AVA" },
            { name: "Ste Chapelle", ava: "Snake River Valley AVA" },
            { name: "Pášxa", ava: "The Rocks of Milton-Freewater AVA" },
            { name: "Rotie Cellars", ava: "The Rocks of Milton-Freewater AVA" },
            { name: "River Rock Vineyard", ava: "The Rocks of Milton-Freewater AVA" },
            { name: "Apolloni VIneyards", ava: "Tualatin Hills AVA" },
            { name: "David Hill Winery", ava: "Tualatin Hills AVA" },
            { name: "Abacela", ava: "Umpqua Valley AVA" },
            { name: "Melrose Vineyards", ava: "Umpqua Valley AVA" },
            { name: "Johan Vineyards", ava: "Van Duzer Corridor AVA" },
            { name: "Elk Cove", ava: "Yamhill-Carlton District AVA" },
            { name: "Soter", ava: "Yamhill-Carlton District AVA" },
            { name: "Shea Vineyard", ava: "Yamhill-Carlton District AVA" }
        ];

        // --- WASHINGTON DATABASE ---
        const allWashingtonData = [
            { name: "Evergreen Vineyard", ava: "Ancient Lakes of Columbia Valley AVA" },
            { name: "Kitzke Cellars", ava: "Candy Mountain AVA" },
            { name: "Atavus Vineyard", ava: "Columbia Gorge AVA (Washington)" },
            { name: "Celio Vineyard", ava: "Columbia Gorge AVA (Washington)" },
            { name: "Analemma", ava: "Columbia Gorge AVA (Washington)" },
            { name: "Hiyu Wine Farm", ava: "Columbia Gorge AVA (Washington)" },
            { name: "Sagemoor Vineyard", ava: "Columbia Valley AVA" },
            { name: "Cold Creek Vineyard", ava: "Columbia Valley AVA" },
            { name: "Stillwater Creek Vineyard", ava: "Columbia Valley AVA" },
            { name: "Goose Ridge Estate Vineyards", ava: "Goose Gap AVA" },
            { name: "Champoux Vineyard", ava: "Horse Heaven Hills AVA" },
            { name: "Canoe Ridge Vineyard", ava: "Horse Heaven Hills AVA" },
            { name: "McKinley Springs Vineyard", ava: "Horse Heaven Hills AVA" },
            { name: "Lake Chelan Winery", ava: "Lake Chelan AVA" },
            { name: "Hard Row to Hoe", ava: "Lake Chelan AVA" },
            { name: "Colter's Creek Vineyard", ava: "Lewis-Clark Valley AVA" },
            { name: "Clearwater Canyon", ava: "Lewis-Clark Valley AVA" },
            { name: "Naches Heights Vineyards", ava: "Naches Heights AVA" },
            { name: "Bainbridge Island Vineyards", ava: "Puget Sound AVA" },
            { name: "Bayernmoore", ava: "Puget Sound AVA" },
            { name: "Vashon Winery", ava: "Puget Sound AVA" },
            { name: "Kennedy Shah", ava: "Rattlesnake Hills AVA" },
            { name: "Savage Grace", ava: "Rattlesnake Hills AVA" },
            { name: "Hyatt Vineyards", ava: "Rattlesnake Hills AVA" },
            { name: "Ciel du Cheval Vineyard", ava: "Red Mountain AVA" },
            { name: "Col Solare", ava: "Red Mountain AVA" },
            { name: "Kiona Vineyard", ava: "Red Mountain AVA" },
            { name: "Klipson Vineyard", ava: "Red Mountain AVA" },
            // Rocky Reach AVA has no data
            { name: "Stillwater Creek Vineyard", ava: "Royal Slope AVA" },
            { name: "Lawrence Vineyard", ava: "Royal Slope AVA" },
            { name: "Frenchman Hills Vineyard", ava: "Royal Slope AVA" },
            { name: "Stoneridge Vineyard", ava: "Royal Slope AVA" },
            { name: "Harrison Hill Vineyard", ava: "Snipes Mountain AVA" },
            { name: "Upland Vineyard", ava: "Snipes Mountain AVA" },
            { name: "Chateau Saint Michelle (Bourne of Fire)", ava: "The Burn of Columbia Valley AVA" },
            { name: "Milbrandt Vineyard", ava: "Wahluke Slope AVA" },
            { name: "Stone Tree Vineyard", ava: "Wahluke Slope AVA" },
            { name: "Fox Estate vineyards", ava: "Wahluke Slope AVA" },
            { name: "Leonetti Cellar", ava: "Walla Walla Valley AVA" },
            { name: "Cayuse", ava: "Walla Walla Valley AVA" },
            { name: "L’Ecole 41", ava: "Walla Walla Valley AVA" },
            { name: "Seven Hills Vineyard", ava: "Walla Walla Valley AVA" },
            { name: "Pepper Bridge Vineyard", ava: "Walla Walla Valley AVA" },
            { name: "Les Collines Vineyard", ava: "Walla Walla Valley AVA" },
            { name: "Woodward Canyon", ava: "Walla Walla Valley AVA" },
            { name: "Claar Cellars", ava: "White Bluffs AVA" },
            { name: "Bacchus Vineyard", ava: "White Bluffs AVA" },
            { name: "Dionysis Vineyard", ava: "White Bluffs AVA" },
            { name: "Gamache Vineyard", ava: "White Bluffs AVA" },
            { name: "Sagemoor Vineyard", ava: "White Bluffs AVA" },
            { name: "Otis Vineyard", ava: "Yakima Valley AVA" },
            { name: "Boushey Vineyard", ava: "Yakima Valley AVA" },
            { name: "Red Willow Vineyard", ava: "Yakima Valley AVA" }
        ];

        // --- SIERRA/MENDO/LAKE DATABASE ---
        const allSierraMendoLakeData = [
            // Lake County
            { name: "Geyser Peak Winery", ava: "Benmore Valley AVA" },
            { name: "Hill Top Oaks Winery", ava: "Big Valley District-Lake County AVA" },
            { name: "Exit West Wines", ava: "Big Valley District-Lake County AVA" },
            { name: "Steele Wines", ava: "Clear Lake AVA" },
            { name: "Sunce Winery", ava: "Clear Lake AVA" },
            { name: "Langtry Farms", ava: "Guenoc Valley AVA" },
            { name: "Brassfield Estate Winery", ava: "High Valley AVA" },
            { name: "Shannon Ridge Wines", ava: "High Valley AVA" },
            { name: "Dancing Crow Vineyards", ava: "Kelsey Bench-Lake County AVA" },
            { name: "Prima Materia Winery", ava: "Kelsey Bench-Lake County AVA" },
            { name: "Hawk and Horse Vineyards", ava: "Red Hills-Lake County AVA" },
            { name: "Obsidian Wine Co.", ava: "Red Hills-Lake County AVA" },
            { name: "Elk Mountain Winery", ava: "Upper Lake Valley AVA" },
            { name: "Elk Mountain Vineyard", ava: "Upper Lake Valley AVA" },
            // Mendocino County
            { name: "Roederer Estate", ava: "Anderson Valley AVA" },
            { name: "Goldeneye", ava: "Anderson Valley AVA" },
            { name: "Savoy", ava: "Anderson Valley AVA" },
            { name: "Cerise", ava: "Anderson Valley AVA" },
            { name: "Bearwallow", ava: "Anderson Valley AVA" },
            { name: "Ferrington", ava: "Anderson Valley AVA" },
            { name: "Mike Lucia", ava: "Cole Ranch AVA" },
            { name: "John Cole", ava: "Cole Ranch AVA" },
            { name: "Comptche Ridge", ava: "Comptche AVA" },
            { name: "Vin de Tevis", ava: "Dos Rios AVA" },
            { name: "Masút", ava: "Eagle Peak Mendocino County AVA" },
            { name: "McDowell Valley Vineyards", ava: "McDowell Valley AVA" },
            { name: "Manchester Ridge", ava: "Mendocino Ridge AVA" },
            { name: "Signal Ridge", ava: "Mendocino Ridge AVA" },
            { name: "Perli", ava: "Mendocino Ridge AVA" },
            { name: "McFadden Family Vineyard & Farm", ava: "Potter Valley AVA" },
            { name: "Vecino Vineyards", ava: "Potter Valley AVA" },
            { name: "Emme Wines", ava: "Redwood Valley AVA" },
            { name:t: "Frey Vineyards", ava: "Redwood Valley AVA" },
            { name: "Lolonis Vineyard", ava: "Redwood Valley AVA" },
            { name: "Hawks Butte Ranch", ava: "Yorkville Highlands AVA" },
            { name: "Weir Vineyard", ava: "Yorkville Highlands AVA" },
            { name: "Halcon", ava: "Yorkville Highlands AVA" },
            { name: "Randle Hill", ava: "Yorkville Highlands AVA" },
            // Sierra Foothills
            { name: "Domaine de la Terre Rouge", ava: "California Shenandoah Valley AVA" },
            { name: "Deaver Vineyards", ava: "California Shenandoah Valley AVA" },
            { name: "The Withers Winery", ava: "El Dorado AVA" },
            { name: "Skinner Vineyards", ava: "El Dorado AVA" },
            { name: "Lava Cap Winery", ava: "El Dorado AVA" },
            { name: "Oakstone Winery", ava: "Fair Play AVA" },
            { name: "Golden Leaves Winery", ava: "Fair Play AVA" },
            { name: "Element 79 Winery", ava: "Fair Play AVA" },
            { name: "Terre Rouge and Easton Wines", ava: "Fiddletown AVA" },
            { name: "Rinaldi Vineyard", ava: "Fiddletown AVA" },
            { name: "Clos Saron", ava: "North Yuba AVA" },
            { name: "Renaissance Vineyard & Winery", ava: "North Yuba AVA" },
            { name: "Taken From Granite", ava: "North Yuba AVA" }
        ];


        // --- GAME DATA WRAPPERS ---
        const sonomaGameData = {
            title: "Sonoma AVA Master",
            producers: sonomaProducersData,
            vineyards: sonomaVineyardsData,
            theme: "theme-text", // Green
            totalRounds: 20
        };
        
        const napaGameData = {
            title: "Napa AVA Master",
            producers: napaProducersData,
            vineyards: napaVineyardsData,
            theme: "napa-text", // Purple
            totalRounds: 20
        };

        const allCentralData = [...centralProducersData, ...centralVineyardsData];
        const centralGameData = {
            title: "Central Coast Master",
            allData: allCentralData, // Combined list
            theme: "central-text", // Blue
            totalRounds: 20
        };

        const oregonGameData = {
            title: "Oregon AVA Master",
            allData: allOregonData,
            theme: "oregon-text", // Emerald
            totalRounds: 10
        };

        const washingtonGameData = {
            title: "Washington AVA Master",
            allData: allWashingtonData,
            theme: "washington-text", // Sky
            totalRounds: 10
        };

        const sierraMendoLakeGameData = {
            title: "Sierra/Mendo/Lake Master",
            allData: allSierraMendoLakeData,
            theme: "sierra-text", // Amber
            totalRounds: 10
        };

        // --- GAME STATE ---
        let currentRound = 1;
        let totalScore = 0;
        let maxPossibleScore = 0;
        let totalRounds = 20; // Will be set by startGameFlow
        const itemsPerRound = 5;

        let selectedLeft = null;
        let selectedRight = null;
        let matchesMade = 0;
        let firstAttemptMap = new Map();
        let activeGameData = null; // Will be set to one of the game data wrappers

        // --- DOM ELEMENTS ---
        const gameContainer = document.getElementById('game-container');
        const startModal = document.getElementById('start-modal');
        const startSonomaBtn = document.getElementById('start-sonoma-btn');
        const startNapaBtn = document.getElementById('start-napa-btn');
        const startCentralBtn = document.getElementById('start-central-btn');
        const startOregonBtn = document.getElementById('start-oregon-btn');
        const startWashingtonBtn = document.getElementById('start-washington-btn');
        const startSierraBtn = document.getElementById('start-sierra-btn');
        const mainMenuBtn = document.getElementById('main-menu-btn');
        const gameTitle = document.getElementById('game-title');
        const scoreInfo = document.getElementById('score-info');
        const roundInfo = document.getElementById('round-info');
        const columnTitle = document.getElementById('column-title');
        const columnAvaTitle = document.getElementById('column-ava-title');
        const leftColumn = document.getElementById('left-column');
        const rightColumn = document.getElementById('right-column');
        const successModal = document.getElementById('success-modal');
        const gameOverModal = document.getElementById('game-over-modal');
        const gameOverTitle = document.getElementById('game-over-title');
        const finalScoreMessage = document.getElementById('final-score-message');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const playAgainBtn = document.getElementById('play-again-btn');

        // --- UTILITY FUNCTIONS ---
        
        /** Shuffles an array in place. */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /** Selects 5 unique items from a data source for the round. */
        function getRoundData() {
            let dataSource;
            
            if (activeGameData.allData) {
                // Use combined list for Central Coast, Oregon, Washington
                dataSource = activeGameData.allData;
                columnTitle.textContent = "Producers & Vineyards";
            } else {
                // Use separate lists for Sonoma and Napa
                const roundGroup = Math.floor((currentRound - 1) / 5);
                if (roundGroup === 0 || roundGroup === 2) {
                    dataSource = activeGameData.producers;
                    columnTitle.textContent = "Producers";
                } else {
                    dataSource = activeGameData.vineyards;
                    columnTitle.textContent = "Vineyards";
                }
            }

            const shuffledSource = [...dataSource];
            shuffleArray(shuffledSource);

            // Pick 5 items with unique AVAs
            const roundItems = [];
            const avasInRound = new Set();
            for (const item of shuffledSource) {
                // Ensure item has a name and ava
                if (item.name && item.ava && !avasInRound.has(item.ava)) {
                    roundItems.push(item);
                    avasInRound.add(item.ava);
                }
                if (roundItems.length === itemsPerRound) {
                    break;
                }
            }
            
            // Fallback: If we still don't have 5 items (e.g., small data source),
            // fill the rest, even if AVAs are duplicated.
            if (roundItems.length < itemsPerRound) {
                 for (const item of shuffledSource) {
                     if (item.name && item.ava && !roundItems.find(i => i.name === item.name)) {
                         roundItems.push(item);
                     }
                     if (roundItems.length === itemsPerRound) {
                         break;
                     }
                 }
            }

            const finalLeftData = roundItems.map(item => ({ name: item.name, ava: item.ava }));
            // Get unique AVAs from the left data for the right column
            const finalRightData = Array.from(new Set(roundItems.map(item => item.ava)));

            // Shuffle both columns independently
            shuffleArray(finalLeftData);
            shuffleArray(finalRightData);

            return { leftData: finalLeftData, rightData: finalRightData };
        }
        
        /** Applies correct theme colors */
        function applyTheme() {
            const themeClass = activeGameData.theme;
            const themes = ["theme-text", "napa-text", "central-text", "oregon-text", "washington-text", "sierra-text"];
            const otherThemes = themes.filter(t => t !== themeClass);
            
            // Apply theme to titles
            [gameTitle, columnTitle, columnAvaTitle, gameOverTitle, finalScoreMessage].forEach(el => {
                el.classList.remove(...otherThemes);
                el.classList.add(themeClass);
            });
            
            // Apply theme to modal buttons
            const buttonThemes = {
                "theme-text": ["theme-bg", "theme-bg-hover"],
                "napa-text": ["napa-bg", "napa-bg-hover"],
                "central-text": ["central-bg", "central-bg-hover"],
                "oregon-text": ["oregon-bg", "oregon-bg-hover"],
                "washington-text": ["washington-bg", "washington-bg-hover"],
                "sierra-text": ["sierra-bg", "sierra-bg-hover"]
            };
            const [bgClass, hoverClass] = buttonThemes[themeClass];
            const otherBg = Object.values(buttonThemes).map(t => t[0]).filter(c => c !== bgClass);
            const otherHover = Object.values(buttonThemes).map(t => t[1]).filter(c => c !== hoverClass);

            [nextRoundBtn, playAgainBtn].forEach(btn => {
                btn.classList.remove(...otherBg, ...otherHover);
                btn.classList.add(bgClass, hoverClass);
            });
        }

        // --- GAME LOGIC ---

        function startGameFlow(gameData) {
            activeGameData = gameData;
            totalRounds = activeGameData.totalRounds; // Set total rounds for this game
            gameTitle.textContent = activeGameData.title;
            applyTheme();
            startModal.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            initGame();
        }
        
        function goToMainMenu() {
            gameContainer.classList.add('hidden');
            startModal.classList.remove('hidden');
            activeGameData = null; // Reset
        }

        function initGame() {
            currentRound = 1;
            totalScore = 0;
            maxPossibleScore = 0;
            startRound();
        }

        function startRound() {
            // Reset round state
            matchesMade = 0;
            selectedLeft = null;
            selectedRight = null;
            firstAttemptMap.clear();
            leftColumn.innerHTML = '';
            rightColumn.innerHTML = '';

            // Update displays
            roundInfo.textContent = `${currentRound} / ${totalRounds}`;
            scoreInfo.textContent = totalScore;

            const { leftData, rightData } = getRoundData();
            
            // Max score is 5 items * 2 points/item
            maxPossibleScore += (itemsPerRound * 2);

            // Populate left column
            leftData.forEach(item => {
                const btn = document.createElement('button');
                btn.className = 'btn-choice w-full text-left p-4 rounded-lg font-semibold';
                btn.textContent = item.name;
                btn.dataset.name = item.name;
                btn.dataset.ava = item.ava;
                btn.addEventListener('click', () => handleLeftClick(btn, item.name, item.ava));
                leftColumn.appendChild(btn);
                // Initialize attempt tracking for this item
                firstAttemptMap.set(item.name, true);
            });

            // Populate right column
            rightData.forEach(ava => {
                const btn = document.createElement('button');
                btn.className = 'btn-choice w-full text-left p-4 rounded-lg font-semibold';
                btn.textContent = ava;
                btn.dataset.ava = ava;
                btn.addEventListener('click', () => handleRightClick(btn, ava));
                rightColumn.appendChild(btn);
            });
        }

        function handleLeftClick(element, name, ava) {
            if (element.classList.contains('correct')) return;

            // Deselect previous left button
            if (selectedLeft && selectedLeft.element !== element) {
                selectedLeft.element.classList.remove('selected');
            }
            // Toggle selection
            if (selectedLeft && selectedLeft.element === element) {
                selectedLeft.element.classList.remove('selected');
                selectedLeft = null;
            } else {
                element.classList.add('selected');
                selectedLeft = { element, name, ava };
            }
            checkMatch();
        }

        function handleRightClick(element, ava) {
            if (element.classList.contains('correct')) return;

            // Deselect previous right button
            if (selectedRight && selectedRight.element !== element) {
                selectedRight.element.classList.remove('selected');
            }
            // Toggle selection
            if (selectedRight && selectedRight.element === element) {
                selectedRight.element.classList.remove('selected');
                selectedRight = null;
            } else {
                element.classList.add('selected');
                selectedRight = { element, ava };
            }
            checkMatch();
        }

        function checkMatch() {
            if (!selectedLeft || !selectedRight) return;

            const leftBtn = selectedLeft.element;
            const rightBtn = selectedRight.element;
            const isFirstAttempt = firstAttemptMap.get(selectedLeft.name);

            if (selectedLeft.ava === selectedRight.ava) {
                // --- CORRECT MATCH ---
                matchesMade++;
                leftBtn.classList.remove('selected');
                rightBtn.classList.remove('selected');
                leftBtn.classList.add('correct');
                rightBtn.classList.add('correct');
                leftBtn.disabled = true;
                rightBtn.disabled = true;

                if (isFirstAttempt) {
                    totalScore += 2;
                } else {
                    totalScore += 1;
                }
                scoreInfo.textContent = totalScore;
                
                // Check if round is over (match count equals number of items)
                if (matchesMade === leftColumn.children.length) {
                    setTimeout(showSuccessModal, 500);
                }
            } else {
                // --- INCORRECT MATCH ---
                totalScore = Math.max(0, totalScore - 1); // Don't go below 0
                scoreInfo.textContent = totalScore;
                // Mark this item as no longer the first attempt
                firstAttemptMap.set(selectedLeft.name, false);
                flashIncorrect(leftBtn, rightBtn);
            }

            // Reset selections
            if (selectedLeft && !selectedLeft.element.classList.contains('correct')) {
                 selectedLeft.element.classList.remove('selected');
            }
            if (selectedRight && !selectedRight.element.classList.contains('correct')) {
                 selectedRight.element.classList.remove('selected');
            }
            selectedLeft = null;
            selectedRight = null;
        }

        function flashIncorrect(btn1, btn2) {
            btn1.classList.add('incorrect');
            btn2.classList.add('incorrect');
            setTimeout(() => {
                btn1.classList.remove('incorrect');
                btn2.classList.remove('incorrect');
            }, 500);
        }

        function showSuccessModal() {
            // Check if game is over *before* showing success modal
            if (currentRound === totalRounds) {
                setTimeout(endGame, 200); // Go straight to end game
                return;
            }

            successModal.classList.remove('hidden');
            setTimeout(() => {
                successModal.firstElementChild.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function hideSuccessModal() {
            successModal.firstElementChild.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                successModal.classList.add('hidden');
                currentRound++;
                startRound();
            }, 200);
        }

        function endGame() {
            const percentage = Math.max(0, Math.round((totalScore / maxPossibleScore) * 100));
            const finalScoreEl = document.getElementById('final-score');
            const finalPercentageEl = document.getElementById('final-percentage');
            
            let feedback = "";
            if (percentage >= 90) {
                feedback = "AVA Master!";
            } else if (percentage >= 70) {
                feedback = "Great job!";
            } else if (percentage >= 50) {
                feedback = "Solid effort!";
            } else {
                feedback = "Good start!";
            }
            
            finalScoreEl.textContent = totalScore;
            finalPercentageEl.textContent = `${percentage}%`;
            finalScoreMessage.textContent = feedback;

            // Hide success modal if it's somehow open
            successModal.classList.add('hidden');

            gameOverModal.classList.remove('hidden');
            setTimeout(() => {
                gameOverModal.firstElementChild.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function hideGameOver() {
            gameOverModal.firstElementChild.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                gameOverModal.classList.add('hidden');
                // Show start modal instead of restarting
                goToMainMenu();
            }, 200);
        }

        // --- EVENT LISTENERS ---
        startSonomaBtn.addEventListener('click', () => startGameFlow(sonomaGameData));
        startNapaBtn.addEventListener('click', () => startGameFlow(napaGameData));
        startCentralBtn.addEventListener('click', () => startGameFlow(centralGameData));
        startOregonBtn.addEventListener('click', () => startGameFlow(oregonGameData));
        startWashingtonBtn.addEventListener('click', () => startGameFlow(washingtonGameData));
        startSierraBtn.addEventListener('click', () => startGameFlow(sierraMendoLakeGameData));
        mainMenuBtn.addEventListener('click', goToMainMenu);
        
        nextRoundBtn.addEventListener('click', hideSuccessModal);
        playAgainBtn.addEventListener('click', hideGameOver);

    </script>
</body>
</html>
